<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khan Academy</title>
    <link rel="icon" type="image/png" href="https://cdn.kastatic.org/images/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --text-scale: 1;
        }

        :root[data-text-size="large"] {
            --text-scale: 1.2;
        }

        :root[data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --accent-color: #00ff88;
            --secondary-color: #888;
            --button-bg: rgba(0, 255, 136, 0.1);
            --button-hover: rgba(0, 255, 136, 0.2);
            --chat-bg: #2a2a2a;
            --ai-msg-bg: #333;
            --user-msg-bg: rgba(0, 255, 136, 0.1);
        }

        :root[data-theme="light"] {
            --bg-color: #f0f0f0;
            --text-color: #1a1a1a;
            --accent-color: #008844;
            --secondary-color: #555;
            --button-bg: rgba(0, 136, 68, 0.1);
            --button-hover: rgba(0, 136, 68, 0.2);
            --chat-bg: #ffffff;
            --ai-msg-bg: #f5f5f5;
            --user-msg-bg: rgba(0, 136, 68, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            font-size: calc(1rem * var(--text-scale));
        }

        .chat-container {
            flex: 1;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            background: var(--chat-bg);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 4rem);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            padding: 1rem;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .ai-message {
            background: var(--ai-msg-bg);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }

        .user-message {
            background: var(--user-msg-bg);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .input-container {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--chat-bg);
            border-top: 2px solid var(--accent-color);
        }

        .chat-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--accent-color);
            border-radius: 25px;
            background: var(--bg-color);
            color: var(--text-color);
            font-size: calc(1rem * var(--text-scale));
            resize: none;
            min-height: 60px;
            max-height: 150px;
            overflow-y: auto;
        }

        .chat-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }

        .send-button {
            padding: 1rem 2rem;
            background: var(--button-bg);
            border: 2px solid var(--accent-color);
            border-radius: 25px;
            color: var(--accent-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: calc(1rem * var(--text-scale));
        }

        .send-button:hover {
            background: var(--button-hover);
            transform: translateY(-2px);
        }

        .back-button {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            padding: 1rem 2rem;
            background: var(--button-bg);
            border: 2px solid var(--accent-color);
            border-radius: 25px;
            color: var(--accent-color);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: calc(1rem * var(--text-scale));
        }

        .back-button:hover {
            background: var(--button-hover);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.2);
        }

        @media (max-width: 768px) {
            .chat-container {
                margin: 0;
                height: 100vh;
                border-radius: 0;
            }

            .back-button {
                bottom: 1rem;
                left: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <div class="message ai-message">
                Hello! I'm your AI assistant. I can help you with:
                • Writing essays and papers
                • Answering questions
                • Explaining concepts
                • Solving problems
                • And much more!
                
                What would you like help with?
            </div>
        </div>
        <div class="input-container">
            <textarea class="chat-input" id="userInput" placeholder="Type your message here..." rows="1"></textarea>
            <button class="send-button" onclick="sendMessage()">Send</button>
        </div>
    </div>
    <a href="index.html" class="back-button">← Back to Menu</a>

    <script>
        // Initialize settings from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            // Theme initialization
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // Text size initialization
            const largeText = localStorage.getItem('largeText') === 'true';
            document.documentElement.setAttribute('data-text-size', largeText ? 'large' : 'normal');

            // Setup textarea auto-resize
            const textarea = document.getElementById('userInput');
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Setup enter key to send
            textarea.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        });

        // Store conversation history
        let conversationHistory = [{
            role: "system",
            content: "You are a helpful AI assistant that specializes in academic help, writing essays, solving problems, and explaining concepts. You should provide detailed, accurate responses while maintaining an engaging tone. For essays and writing tasks, provide structured outlines and examples. For math and science, show step-by-step solutions. For explanations, use simple language and relevant examples."
        }, {
            role: "assistant",
            content: "Hello! I'm your AI assistant. I can help you with:\n• Writing essays and papers\n• Answering questions\n• Explaining concepts\n• Solving problems\n• And much more!\n\nWhat would you like help with?"
        }];

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (message) {
                // Add user message to UI and history
                addMessage(message, 'user-message');
                conversationHistory.push({
                    role: "user",
                    content: message
                });
                
                input.value = '';
                input.style.height = 'auto';
                
                // Show typing indicator
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai-message';
                typingDiv.textContent = 'Typing...';
                document.getElementById('chatMessages').appendChild(typingDiv);
                
                try {
                    // Make API request to ChatGPT
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer YOUR_API_KEY_HERE' // Replace with actual API key
                        },
                        body: JSON.stringify({
                            model: "gpt-3.5-turbo",
                            messages: conversationHistory,
                            max_tokens: 500,
                            temperature: 0.7
                        })
                    });

                    const data = await response.json();
                    
                    // Remove typing indicator
                    typingDiv.remove();
                    
                    if (data.choices && data.choices[0]) {
                        const aiResponse = data.choices[0].message.content;
                        addMessage(aiResponse, 'ai-message');
                        conversationHistory.push({
                            role: "assistant",
                            content: aiResponse
                        });
                    } else {
                        throw new Error('Invalid API response');
                    }
                } catch (error) {
                    // Remove typing indicator
                    typingDiv.remove();
                    
                    // If API call fails, use fallback responses
                    const fallbackResponse = generateFallbackResponse(message);
                    addMessage(fallbackResponse, 'ai-message');
                    conversationHistory.push({
                        role: "assistant",
                        content: fallbackResponse
                    });
                }
            }
        }

        function addMessage(text, className) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            
            // Convert line breaks to <br> tags and preserve formatting
            const formattedText = text.replace(/\n/g, '<br>');
            messageDiv.innerHTML = formattedText;
            
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function generateFallbackResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            // Enhanced fallback responses
            if (lowerMessage.includes('essay') || lowerMessage.includes('write')) {
                return `Here's how I can help you write your essay:

1. First, let's create an outline:
   • Introduction with thesis statement
   • 3-4 body paragraphs with main points
   • Conclusion that restates and reflects

2. For each paragraph:
   • Start with a topic sentence
   • Add supporting evidence
   • Include citations
   • End with a transition

What's your essay topic? I'll help you develop specific points and arguments.`;
            }
            else if (lowerMessage.includes('math') || lowerMessage.includes('solve')) {
                return `Let's solve this step by step:

1. First, let's identify the key information
2. Then we'll determine the appropriate method
3. We'll solve it showing all work
4. Finally, we'll verify the answer

Please share the math problem, and I'll guide you through each step.`;
            }
            else if (lowerMessage.match(/what|how|why|when|where|explain/i)) {
                return `I'll explain this topic clearly:

1. Basic Definition
2. Key Concepts
3. Real-world Examples
4. Common Applications

What specific aspect would you like me to explain in detail?`;
            }
            else {
                return `I can help you with:

1. Writing & Essays
   • Outlines and structure
   • Research assistance
   • Proofreading tips

2. Math & Problem Solving
   • Step-by-step solutions
   • Formula explanations
   • Practice problems

3. General Knowledge
   • Detailed explanations
   • Examples and analogies
   • Study guides

What specific area would you like to focus on?`;
            }
        }
    </script>
</body>
</html> 